# EWC (Elastic Weight Consolidation) Fine-tuning Configuration Example
# EWC prevents catastrophic forgetting by regularizing important parameters

model:
  architecture: nequip
  package_path: /path/to/pretrained_model.nequip.zip
  r_max: 6.0
  compile_mode: eager

data:
  finetune_data: /path/to/finetune_data.xyz
  batch_size: 8
  train_split: 0.8
  val_split: 0.2
  test_split: 0.0

training:
  epochs: 100
  lr: 1e-4
  optimizer: adam
  scheduler:
    type: ReduceLROnPlateau
    patience: 10
    factor: 0.5
    min_lr: 1e-6
  early_stopping:
    patience: 20
    min_delta: 1e-6

loss_coeffs:
  energy: 0.0       # Weight for energy loss
  force: 100.0      # Weight for force loss  
  stress: 0.0       # Weight for stress loss

# Metrics to track during training (logged to wandb/tensorboard)
# Available: energy_mae, energy_rmse, energy_mae_per_atom, energy_rmse_per_atom,
#            force_mae, force_rmse, force_magnitude_mae, force_cosine, force_cosine_std
metrics:
  - energy_mae
  - energy_mae_per_atom
  - force_mae
  - force_cosine

strategy:
  name: ewc
  
  # EWC-specific parameters
  ewc_lambda: 1000.0                    # Regularization strength
  precomputed_fisher_path: /path/to/fisher.pt  # Pre-computed Fisher matrix
  
  # Fisher computation settings (if not using precomputed)
  fisher_samples: null                  # null = use all samples
  diagonal_only: true                   # Use diagonal Fisher approximation
  fisher_normalize: max                 # Normalization method: max, mean, layer, none
  fisher_threshold: 0.0                 # Minimum Fisher value threshold
  
  # Online EWC for sequential tasks
  online_ewc: false
  gamma: 1.0                            # Decay factor for online EWC

logging:
  tensorboard: true
  log_interval: 1
  save_checkpoint_interval: 10
  
  # Weights & Biases configuration
  wandb:
    enabled: true                       # Enable W&B logging
    project: mlip-finetune              # W&B project name
    name: null                          # Run name (auto-generated if null)
    entity: null                        # W&B team/entity
    tags: ["ewc", "nequip"]             # Tags for filtering runs
    notes: "EWC fine-tuning experiment" # Run description
    log_model: true                     # Upload model artifacts

device: cuda
seed: 42
deterministic: true

